# Проектная работа "web-larek-frontend"

## Используемый стек

HTML, SCSS, TypeScript в ООП-стиле. Webpack.

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build

```

## О проекте

Проект представляет собой приложение интернет-магазин для продажи цифровых товаров,
реализованное на TypeScript с использованием ООП-подхода и архитектуры MVP.


### Приложение включает в себя

- получение с сервера данных списка о продукции;
- просмотр каталога товаров;
- многоэтапное оформление заказа;
- управление корзиной;
- отправка данных о заказе на сервер;


### Бизнес логика

- добавление и удаление товара в корзину;
- выборр способа оплаты;
- ввод данных;
- валидация форм заказа;
- рассчёт общей стоимости;
- история заказов;
- покупка бесценных товаров;
- обработка ошибок API;


### В коде используются cart (состояние) и basket (UI)

- Basket
Это UI-компонент, который отвечает за отображение корзины на экране:
Визуализация списка товаров в корзине;
Отображение общей суммы;
Обработка кликов (например, открытие формы заказа);

- Cart
Это часть состояния приложения, которая хранит данные о выбранных товарах:
Хранение списка товаров (items);
Подсчёт общей суммы (total);
Логика добавления/удаления товаров;


### Техническая реализация

- MVP для разделения ответственности
- EventEmitter для связывания компонентов


## Архитектура проекта

В проекте используется архитектурный шаблон MVP (Model-View-Presenter).
Он разделяет приложение на три основных компонента:

- модель (Model) - представляет данные и бизнес-логику приложения;
- представление (View) - тображает данные пользователю и обрабатывает пользовательский ввод;
- презентер (Presenter) - правляет взаимодействием между моделью и представлением.


### Ключевые принципы

Изолированность: Каждый модуль работает независимо;
Единая ответственность: Четкое разделение на Model-View-Presenter;
Масштабируемость: Легко добавлять новые функции без изменения ядра;


## Базовые классы

### Класс Api (src/components/base/api.ts)
Реализует при работе с API: отправку запросов, получение ответов, приведение полученных данных в массив, формирование ссылок через CDN, защиту от битых ссылок;

поля:
- private readonly baseUrl - базовый адрес сервера;
- private readonly cdnUrl - ссылка на коллекцию товаров;

конструктор:
- constructor(baseUrl: string = API_URL, cdnUrl: string = CDN_URL) - инициализирует клиент API устанавливая ссылки на сервер и коллекцию товара;

методы:
- async getProducts(): Promise<Product[]> - запрашивает список товаров и возвращает обработанные данные;
- private processProducts(items: any[]): Product[] - Преобразует сырые данные API в массив объектов;
- private processImageUrl(imageUrl?: string): string - Обрабатывает URL изображения, добавляя при необходимости cdnUrl;


### Класс Component (src/components/base/Component.ts)
Базовый класс для всех UI-компонентов, реализующий общую логику работы с DOM.

поля:
- protected container(): HTMLElement - контейнер компонента;
- protected events: Record<string, (e: Event) => void> - хранилище обработчиков событий;

конструктор:
- constructor(tagName: string = 'div', className: string = '') - создает DOM-элемент;

методы:
- render(): HTMLElement - возвращает сконструированный DOM-элемент;
- protected setEvent(event: string, callback: (e: Event) => void): void - устанавливает обработчик события;
- protected removeEvent(event: string): void - удаляет обработчик события;


### Класс EventEmitter (src/components/base/events.ts)
Брокер событий, централизованная система событий (реализует паттерн "Наблюдатель").

поля:
- _events - хранит подписки на события;

конструктор:
- constructor() - инициализирует карту _events;

методы:
- on - подписка на событие;
- off - отписывает от события;
- emit - инициирует событие;
- onAll - подписывает на все события;
- offAll - сбрасывает все подписки;
- trigger - возвращает функцию, которая при вызове инициирует событие;


### Класс Model (src/components/base/Model.ts)
Базовый класс для моделей данных, обеспечивающий работу с состоянием приложения.

поля:
- protected events: EventEmitter - экземпляр EventEmitter для работы с событиями;
- protected state: IAppState - текущее состояние приложения;

методы:
- protected setState(newState: Partial<IAppState>): void - обновляет состояние;
- getState(): IAppState - возвращает текущее состояние;
- on(event: string, callback: (data: any) => void): void - подписка на события;
- off(event: string, callback: (data: any) => void): void - отписка от событий;


## Компоненты

### Класс AppData (src/components/AppData.ts)
Хранение текущего состояния (товары, корзина, заказ), координация работы других компонентов.

поля:
- private _products: ;
- private _cart: ;
- private _order: ;
- private _preview: ;

методы:
- loadProducts() - загрузка товаров с сервера;
- updateBasket() - обновление состояния корзины;
- submitOrder() - оформление заказа;


### Класс Card (src/components/Card.ts)
Управляет отображением товара, обрабатывает взаимодействия, интегрируется с API.

поля:
- _title - Заголовок карточки;
- _image - Изображение товара;
- _price - Цена товара;
- _category - Категория товара;
- _button - Кнопка действия;
- _index - Индекс товара в корзине;

конструктор:
- constructor(container: HTMLElement, actions?: ICardActions) - Инициализирует DOM-элементы карточки;

геттер:
- get containerElement() - Возвращает корневой DOM-элемент карточки;

сеттеры:
- set id(value)	- Устанавливает data-id для контейнера;
- set title(value) - Обновляет текст в _title;
- set price(value) - Форматирует цену (например, "100 синапсов");
- set category(value) - Устанавливает текст и CSS-класс для категории (например, card__category_soft);
- set image(value) - Меняет src и alt у изображения;
- set index(value) - Обновляет индекс товара в корзине;


### Класс LarekAPI (src/components/LarekAPI.ts)
Расширяет базовый ApiClient, реализует специфичные для приложения API-запросы.

конструктор:
- constructor(baseUrl: string, protected cdnUrl: string);

методы:
- async getProductList(): Promise<IProduct[]> - получает список товаров;
- async orderProducts(order: IOrder): Promise<IOrderResult> - отправляет заказ на сервер;


### Класс Order (src/components/Order.ts)
Управляет формой заказа, генерирует события, интегрируется с системой событий.

конструктор:
- constructor(container: HTMLElement, events: IEvents) - Инициализирует форму заказа и настраивает обработчик отправки.

поля:
- _button - Кнопка отправки формы (например, «Оформить заказ»);
- _errors - Контейнер для отображения ошибок валидации;
- events - Объект для работы с событиями (например, EventEmitter);

геттер:
- get containerElement() - возвращает корневой DOM-элемент формы;

сеттеры:
- set valid(value) - блокирует/разблокирует кнопку (!value → кнопка неактивна);
- set address(value) - устанавливает значение поля «Адрес» в форме;
- set errors(value) - отображает текст ошибок в контейнере _errors;


### Класс Page (src/components/Page.ts)
Управляет отображением страницы и основными DOM-элементами.

поля:
- protected basket: Basket - экземпляр корзины;
- protected modal: Modal - экземпляр модального окна;

методы:
- render(): HTMLElement - рендерит основную страницу;
- setCatalog(items: IProduct[]): void - отображает каталог товаров;
- setCounter(count: number): void - обновляет счетчик товаров в корзине;


## Общие классы

### Класс Basket (src/components/common/Basket.ts)
Управляет корзиной товаров.

поля:
- protected items: IProduct[] - товары в корзине;
- protected total: number - общая стоимость

методы:
- add(item: IProduct): void - добавляет товар в корзину;
- remove(id: string): void - удаляет товар из корзины;
- clear(): void - очищает корзину;
- getTotal(): number - возвращает общую стоимость;


### Класс Form (src/components/common/Form.ts)
Базовый класс для форм ввода данных.

поля:
- protected valid: boolean - флаг валидности формы;
- protected errors: IFormErrors - ошибки валидации;

методы:
- validate(): boolean - проверяет валидность формы;
- clear(): void - очищает форму;
- setErrors(errors: IFormErrors): void - устанавливает ошибки;

### Класс Modal (src/components/common/Modal.ts)
Управляет модальными окнами.

методы:
- open(content: HTMLElement): void - открывает модальное окно;
- close(): void - закрывает модальное окно;
- private handleClose(e: Event): void - обработчик закрытия;

### Класс Success (src/components/common/Modal.ts)
Реализует окно с подтверждением заказа.

поля:
- _close - элемент кнопки закрытия окна;
- _total - элемент с суммой заказа;

сеттер:
- total - меняет содержимое элемента с суммой заказа;


### Интерфейсы (src/types/index.ts)

- interface Product;
- interface IOrderForm;
- interface IOrderData extends IOrderForm;
- interface ICartItem extends Product;
- interface ICard;
- interface IOrderResult;
- interface IFormErrors;
- interface IModalData;


## Поток данных

### Инициализация:
- Page -> (запрос) -> LarekAPI -> (ответ) -> AppData;
- AppData обновляет состояние -> Page отображает товары;

### Добавление в корзину:
- ProductCard (click) -> EventEmitter -> AppData;
- AppData обновляет cart -> Basket (через EventEmitter);

### Оформление заказа:
- OrderForm (submit) -> EventEmitter -> AppData;
- AppData -> LarekAPI -> Success/Error;


## Взаимодействие компонентов

Пользователь взаимодействует с View;
View генерирует события через EventEmitter;
Presenter обрабатывает события и обновляет Model;
Model уведомляет об изменениях через EventEmitter;

### Инициализация приложения:

AppData - загружает товары через LarekAPI;
Page - отображает каталог товаров;
Basket - инициализируется пустой корзиной;

### Добавление товара в корзину:

ProductCard генерирует событие 'card:select';
AppData обновляет состояние корзины;
Page обновляет счетчик товаров;

### Оформление заказа:

Basket генерирует событие 'order:open';
OrderForm отображает форму ввода данных;
При успешном заполнении отправляет данные через LarekAPI;


## API взаимодействие с сервером
+---------------------------------------------------------------------------------------------+
| Метод    | Эндпоинт         | Описание                                                      |
|----------|------------------|---------------------------------------------------------------|
| `GET`    | `/products`      | Получает список всех товаров. Возвращает `Product[]`.         |
| `GET`    | `/product/{id}`  | Получение детальной информации о конкретном товаре `Product`. |
| `POST`   | `/orders`        | Создает новый заказ. Требует все поля из `IOrderData`.        |
| `DELETE` | `/orders/{id}`   | Отменяет заказ по ID. Доступно только в статусе "не оплачен". |
+---------------------------------------------------------------------------------------------+




### Примеры запросов


## Обработка ошибок

### Стандартные HTTP-статусы
+---------------------------------------------------------------------+
| Код  | Тип ошибки           | Типичные сценарии                     |
|------|----------------------|---------------------------------------|
| `400`| Bad Request          | Неверный формат данных в запросе      |
| `404`| Not Found            | Товар или заказ не существует         |
| `500`| Internal Server Error| Ошибка на сервере                     |
+---------------------------------------------------------------------+

## Функциональные требования

Главная страница:

- просмотр каталога товаров;
- фильтрация по категориям;
- поиск по названию;
- модальное окно с описанием товара;

Корзина:

- добавление/удаление товаров;
- изменение количества;
- расчёт итоговой суммы;

Оформление заказа:

- ввод адреса доставки;
- выботр способа оплаты;
- подтверждение заказа;
- товар с ценой 'null' ("Бесценно");
- валидация форм ввода;

### Общие требования:

Модальные окна закрываются при клике вне модального окна, по клавише 'Esc' или по иконке «В корзину».
Кнопка перехода к следующему шагу доступна только если действия на текущей странице выполнены (например, указание телефона и почты).